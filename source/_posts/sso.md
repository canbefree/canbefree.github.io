---
title: SSO单点登录
date: 2016-11-04 03:37:07
tags:
    - php
    - sso
---


### SSO单点登录
简而言之：单点登录就是多个应用合用一个登录系统。

### 注册应用
SSO应该要满足一下条件
1.注册应用功能。
2.保存用户登录状态。
3.应用token验证。（安全）

### SSO登录逻辑
![sso单点登录](sso单点登录.png)

1.用户登录应用或直接访问应用某个功能
2.重定向到SSO,SSO记录用户登录状态,并返回用户信息(带token验证)
3.应用保存用户信息（一般存到游览器cookie,下次请求可以直接用cookie就不用重复使用2,3步）
4.应用根据cookie的用户信息请求应用权限。
5.SSO返回用户应用权限。
6.展示内容给用户。


### 代码逻辑
![单点登录流程图](单点登录流程图.png)


###  其他方式设置单点登录
如果现在有两个网站A和B,A请求了B的东西，B的服务器setCookie，A发请求的时候默认是不带B的服务器所设置的cookie，因此为了让cookie共享，B返回的请求可以加上

```java
response.addHeader("P3P", "CP=CAO PSA OUR");  
```
利用这个也可以实现。相当于sso主动将自己的cookie共享到浏览器的其他tab上。用户可以直接用cookie带的token去请求应用权限。直接省去2,3步骤

**也有缺点,用户可以手动屏蔽掉这个cookie，导致不能登录.**
